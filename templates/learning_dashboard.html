<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>学习进度 - 上岸翻身营</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .progress-ring {
            transform: rotate(-90deg);
        }

        .progress-ring-circle {
            transition: stroke-dashoffset 0.35s;
            transform: rotate(90deg);
            transform-origin: 50% 50%;
        }

        .section-card {
            transition: all 0.3s ease;
            border-left: 4px solid #0d6efd;
        }

        .section-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .tool-card {
            border: none;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
        }

        .tool-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
        }

        .achievement-badge {
            background: linear(45deg, #ffd700, #ffed4e);
            border-radius: 20px;
            padding: 8px 16px;
            font-weight: 600;
            color: #856404;
        }

        .learning-path {
            position: relative;
            padding-left: 30px;
        }

        .learning-path::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #e9ecef;
        }

        .path-node {
            position: relative;
            margin-bottom: 25px;
        }

        .path-node::before {
            content: '';
            position: absolute;
            left: -23px;
            top: 5px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #0d6efd;
            border: 3px solid white;
            box-shadow: 0 0 0 2px #0d6efd;
        }

        .path-node.completed::before {
            background: #198754;
            box-shadow: 0 0 0 2px #198754;
        }

        .path-node.current::before {
            background: #ffc107;
            box-shadow: 0 0 0 2px #ffc107;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(255, 193, 7, 0.7);
            }

            70% {
                box-shadow: 0 0 0 10px rgba(255, 193, 7, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(255, 193, 7, 0);
            }
        }
    </style>
</head>

<body>
    <div class="container-fluid py-4">
        <!-- 页面标题 -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h1 class="h3 mb-1">学习进度追踪</h1>
                        <p class="text-muted mb-0">系统学习债务管理，科学制定还款计划</p>
                    </div>
                    <div class="text-end">
                        <span class="badge bg-primary fs-6">专业版</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- 总体进度 -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card border-0 shadow-sm">
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col-md-3 text-center">
                                <div class="position-relative d-inline-block">
                                    <svg width="120" height="120" class="progress-ring">
                                        <circle cx="60" cy="60" r="54" stroke="#e9ecef" stroke-width="8" fill="none" />
                                        <circle cx="60" cy="60" r="54" stroke="#0d6efd" stroke-width="8" fill="none"
                                            stroke-dasharray="339.292" stroke-dashoffset="0"
                                            class="progress-ring-circle" id="overallProgressCircle" />
                                    </svg>
                                    <div class="position-absolute top-50 start-50 translate-middle text-center">
                                        <h3 class="mb-0 fw-bold" id="overallProgress">0%</h3>
                                        <small class="text-muted">总体进度</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-9">
                                <div class="row">
                                    <div class="col-sm-4 mb-3">
                                        <div class="text-center p-3 bg-light rounded">
                                            <h4 class="text-primary mb-1" id="completedSteps">0</h4>
                                            <small class="text-muted">已完成步骤</small>
                                        </div>
                                    </div>
                                    <div class="col-sm-4 mb-3">
                                        <div class="text-center p-3 bg-light rounded">
                                            <h4 class="text-success mb-1" id="totalTime">0</h4>
                                            <small class="text-muted">学习时长(分钟)</small>
                                        </div>
                                    </div>
                                    <div class="col-sm-4 mb-3">
                                        <div class="text-center p-3 bg-light rounded">
                                            <h4 class="text-info mb-1" id="remainingTime">0</h4>
                                            <small class="text-muted">预计剩余(分钟)</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <div class="d-flex justify-content-between mb-1">
                                        <span>课程进度</span>
                                        <span id="progressText">0/0 步骤</span>
                                    </div>
                                    <div class="progress" style="height: 8px;">
                                        <div class="progress-bar" role="progressbar" id="progressBar" style="width: 0%">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- 左侧：学习路径 -->
            <div class="col-lg-8 mb-4">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-header bg-white border-0 py-3">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-road me-2 text-primary"></i>
                            学习路径
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="learning-path" id="learningPath">
                            <!-- 学习路径内容将通过JavaScript动态加载 -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- 右侧：工具和活动 -->
            <div class="col-lg-4">
                <!-- 专业工具 -->
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-header bg-white border-0 py-3">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-tools me-2 text-warning"></i>
                            专业工具
                        </h5>
                    </div>
                    <div class="card-body" id="toolsSection">
                        <!-- 工具内容将通过JavaScript动态加载 -->
                    </div>
                </div>

                <!-- 最近活动 -->
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white border-0 py-3">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-history me-2 text-info"></i>
                            最近学习活动
                        </h5>
                    </div>
                    <div class="card-body" id="recentActivity">
                        <!-- 活动内容将通过JavaScript动态加载 -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 页面加载完成后获取学习进度
        document.addEventListener('DOMContentLoaded', function () {
            loadLearningProgress();
            loadProfessionalTools();
        });

        function loadLearningProgress() {
            fetch('/api/learning-progress')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        updateProgressDisplay(data);
                        updateLearningPath(data);
                        updateRecentActivity(data);
                    } else {
                        showError('加载学习进度失败');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showError('网络错误，请重试');
                });
        }

        function loadProfessionalTools() {
            fetch('/api/professional-tools')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        updateToolsDisplay(data.tools);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }

        function updateProgressDisplay(data) {
            const progress = data.progress;

            // 更新总体进度
            document.getElementById('overallProgress').textContent = progress.overall_progress + '%';
            document.getElementById('completedSteps').textContent = progress.completed_steps;
            document.getElementById('totalTime').textContent = progress.total_time_spent;
            document.getElementById('remainingTime').textContent = progress.estimated_remaining;
            document.getElementById('progressText').textContent =
                progress.completed_steps + '/' + progress.total_steps + ' 步骤';

            // 更新进度条
            document.getElementById('progressBar').style.width = progress.overall_progress + '%';

            // 更新圆形进度条
            const circle = document.getElementById('overallProgressCircle');
            const radius = 54;
            const circumference = 2 * Math.PI * radius;
            const offset = circumference - (progress.overall_progress / 100) * circumference;
            circle.style.strokeDasharray = circumference;
            circle.style.strokeDashoffset = offset;
        }

        function updateLearningPath(data) {
            const pathContainer = document.getElementById('learningPath');
            let pathHTML = '';

            data.sections.forEach((section, sectionIndex) => {
                pathHTML += `
                    <div class="path-node ${sectionIndex === 0 ? 'current' : ''}">
                        <div class="card section-card mb-3">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <h6 class="card-title mb-0">${section.title}</h6>
                                    <span class="badge bg-light text-dark">${section.completed}/${section.total} 完成</span>
                                </div>
                                <div class="progress mb-2" style="height: 6px;">
                                    <div class="progress-bar" style="width: ${section.progress}%"></div>
                                </div>
                                <small class="text-muted">进度: ${section.progress}%</small>
                            </div>
                        </div>
                    </div>
                `;
            });

            pathContainer.innerHTML = pathHTML;
        }

        function updateToolsDisplay(tools) {
            const toolsContainer = document.getElementById('toolsSection');
            let toolsHTML = '';

            tools.forEach(tool => {
                toolsHTML += `
                    <div class="card tool-card mb-3">
                        <div class="card-body">
                            <div class="d-flex align-items-start mb-2">
                                <div class="flex-shrink-0">
                                    <i class="fas fa-${tool.icon} text-${tool.color} fa-2x"></i>
                                </div>
                                <div class="flex-grow-1 ms-3">
                                    <h6 class="card-title mb-1">${tool.name}</h6>
                                    <p class="card-text small text-muted mb-2">${tool.description}</p>
                                    <div class="mb-2">
                                        ${tool.features.map(feature =>
                    `<span class="badge bg-light text-dark me-1 mb-1 small">${feature}</span>`
                ).join('')}
                                    </div>
                                    <button class="btn btn-${tool.color} btn-sm" onclick="window.location.href='${tool.url}'">
                                        <i class="fas fa-${tool.button_text.includes('下载') ? 'download' : 'play'} me-1"></i>
                                        ${tool.button_text}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });

            toolsContainer.innerHTML = toolsHTML;
        }

        function updateRecentActivity(data) {
            const activityContainer = document.getElementById('recentActivity');

            if (data.recent_activity && data.recent_activity.length > 0) {
                let activityHTML = '';

                data.recent_activity.forEach(activity => {
                    activityHTML += `
                        <div class="d-flex align-items-center mb-3">
                            <div class="flex-shrink-0">
                                <i class="fas fa-check-circle text-success"></i>
                            </div>
                            <div class="flex-grow-1 ms-3">
                                <div class="small">${activity.step}</div>
                                <div class="text-muted smaller">
                                    ${activity.completion_time} • ${activity.time_spent}分钟
                                </div>
                            </div>
                        </div>
                    `;
                });

                activityContainer.innerHTML = activityHTML;
            } else {
                activityContainer.innerHTML = `
                    <div class="text-center text-muted py-4">
                        <i class="fas fa-clock fa-2x mb-2"></i>
                        <p class="mb-0">暂无学习记录</p>
                        <small>开始学习后，这里会显示您的学习轨迹</small>
                    </div>
                `;
            }
        }

        function showError(message) {
            // 简单的错误提示
            alert(message);
        }

        // 标记步骤完成
        function completeStep(stepId, timeSpent = 30) {
            fetch('/api/update-learning-progress', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    step_id: stepId,
                    time_spent: timeSpent
                })
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        loadLearningProgress(); // 重新加载进度
                    } else {
                        showError('更新进度失败');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showError('网络错误');
                });
        }
    </script>
</body>

</html>